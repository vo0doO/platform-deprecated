<html lang="en">
<title>Apollo</title>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    {% load static %}
    {% load tags %}


    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js" integrity="sha384-pjaaA8dDz/5BgdFUPX6M/9SUZv4d12SUPF0axWc+VRZkx5xU3daN+lYb49+Ax+Tl" crossorigin="anonymous"></script>


    <link rel="stylesheet" href="{% static 'polls/css/apollo.css' %}">
    <link rel="stylesheet" href="{% static 'polls/css/odometer-theme-minimal.css' %}">


    <script src="{% static 'polls/js/Chart.min.js' %}"></script>
    <script src="{% static 'polls/js/odometer.min.js' %}"></script>




</head>

<header>

<nav class="navbar navbar-light navbar-expand-md">
    <a class="navar-brand" href="#">
        <img src="{% static 'polls/images/Apollo.png' %}" class="m-3" width="150px">
    </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav ml-4 mr-auto">
      <li class="nav-item mx-3">
        <a class="nav-link active" href="#">Polls <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item mx-3">
        <a class="nav-link" href="#">History</a>
      </li>
    </ul>
    <span class="navbar-nav">
        <a class="nav-link" href="#">Login</a>
        <span id="roomid">Room: #{{room.roomid}}</span>
    </span>
  </div>
</nav>


</header>

<body style="text-align: center; margin-left: auto; margin-right: auto;">

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0px" height="0px" style="position: absolute;" version="1.1">
    <!-- Generator: Sketch 51.2 (57519) - http://www.bohemiancoding.com/sketch -->
    <title>MC icon</title>

    <defs>
        <symbol id="MC-icon2" viewbox="0 0 26 18">
            <ellipse id="Oval" cx="1.77226779" cy="2" rx="1.77226779" ry="2"/>
            <rect id="Rectangle-4" x="6.20293725" y="1" width="19.4949456" height="3"/>
            <ellipse id="Oval" cx="1.77226779" cy="9" rx="1.77226779" ry="2"/>
            <rect id="Rectangle-4" x="6.20293725" y="8" width="19.4949456" height="3"/>
            <ellipse id="Oval" cx="1.77226779" cy="16" rx="1.77226779" ry="2"/>
            <rect id="Rectangle-4" x="6.20293725" y="15" width="19.4949456" height="3"/>
        </symbol>
    </defs>
</svg>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0" height="0" style="position: absolute" version="1.1">
    <!-- Generator: Sketch 51.2 (57519) - http://www.bohemiancoding.com/sketch -->
    <title>YN Icon</title>
    <defs>
        <symbol id="YN-icon2" viewBox="0 0 47 26">
            <g id="thumbs-up-regular" transform="translate(29.605664, 1.300000)">
                <path d="M17.6480683,13.1026289 C17.9800081,12.4239375 18.1677414,11.7 18.1677414,10.8247852 C18.1677414,8.81316211 16.7590601,6.91351172 14.9195006,6.91351172 L13.5387523,6.91351172 C13.7249716,6.32805469 13.87372,5.62788281 13.87372,4.78648828 C13.87372,1.459575 12.4471738,0 10.2678018,0 C7.93601009,0 8.06901309,4.33873477 7.55172451,4.96335938 C6.69076281,6.00296836 5.67382349,8.00019492 4.94919555,8.775 L1.21118276,8.775 C0.542269231,8.775 0,9.42978867 0,10.2375 L0,21.20625 C0,22.0139613 0.542269231,22.66875 1.21118276,22.66875 L3.63354828,22.66875 C4.19724031,22.66875 4.67092631,22.2037664 4.80604889,21.5741602 C6.49069056,21.619909 7.64702945,23.399543 11.5357588,23.399543 C11.8090319,23.399543 12.1118276,23.4 12.3767738,23.4 C15.2956107,23.4 16.6153836,21.5982457 16.651492,19.0431211 C17.155609,18.201041 17.4197982,17.0723109 17.3078016,15.9814688 C17.6807702,15.1381547 17.8249767,14.1376676 17.6480683,13.1026289 Z M15.3108641,15.5628281 C15.7862533,16.5285352 15.3585544,17.8210195 14.7832426,18.193957 C15.0746834,20.4233555 14.1167893,21.205793 12.7726792,21.205793 L11.3412126,21.205793 C8.62971501,21.205793 6.87387851,19.4773008 4.84473104,19.4773008 L4.84473104,10.96875 L5.25804716,10.96875 C6.33145788,10.96875 7.83105353,7.72885547 8.83633522,6.51452344 C9.90974594,5.21838281 9.55206853,3.05799609 10.2678018,2.19375 C12.0569459,2.19375 12.0569459,3.70103906 12.0569459,4.78648828 C12.0569459,6.57667969 10.9835352,7.37876953 10.9835352,9.10726172 L14.9195006,9.10726172 C15.7185028,9.10726172 16.3475608,9.97150781 16.3509673,10.8357539 C16.3543737,11.699543 15.8657372,12.5637891 15.5080598,12.5637891 C16.0186111,13.228998 16.1276933,14.6312156 15.3108641,15.5628281 Z M3.33075259,19.74375 C3.33075259,20.3495449 2.92406013,20.840625 2.42236552,20.840625 C1.92067091,20.840625 1.51397845,20.3495449 1.51397845,19.74375 C1.51397845,19.1379551 1.92067091,18.646875 2.42236552,18.646875 C2.92406013,18.646875 3.33075259,19.1379551 3.33075259,19.74375 Z" id="Shape"/>
            </g>
            <g id="thumbs-up-regular-copy" transform="translate(11.157277, 13.000000) scale(-1, -1) translate(-11.157277, -13.000000) translate(0.657277, 0.000000)">
                <path d="M19.8540768,14.5584766 C20.2275091,13.804375 20.4387091,13 20.4387091,12.0275391 C20.4387091,9.79240234 18.8539427,7.68167969 16.7844382,7.68167969 L15.2310963,7.68167969 C15.4405931,7.03117188 15.607935,6.25320313 15.607935,5.31832031 C15.607935,1.62175 14.0030706,0 11.5512771,0 C8.92801135,0 9.07763973,4.82081641 8.49569007,5.51484375 C7.52710816,6.66996484 6.38305142,8.88910547 5.567845,9.75 L1.3625806,9.75 C0.610052885,9.75 0,10.477543 0,11.375 L0,23.5625 C0,24.459957 0.610052885,25.1875 1.3625806,25.1875 L4.08774181,25.1875 C4.72189534,25.1875 5.2547921,24.6708516 5.406805,23.9712891 C7.30202688,24.0221211 8.60290813,25.9994922 12.9777286,25.9994922 C13.2851609,25.9994922 13.625806,26 13.9238706,26 C17.2075621,26 18.6923065,23.9980508 18.7329285,21.1590234 C19.3000601,20.2233789 19.597273,18.9692344 19.4712768,17.7571875 C19.8908665,16.8201719 20.0530988,15.7085195 19.8540768,14.5584766 Z M17.2247221,17.2920313 C17.759535,18.3650391 17.2783737,19.8011328 16.6311479,20.2155078 C16.9590188,22.6926172 15.8813879,23.5619922 14.3692641,23.5619922 L12.7588641,23.5619922 C9.70842939,23.5619922 7.73311332,21.6414453 5.45032242,21.6414453 L5.45032242,12.1875 L5.91530305,12.1875 C7.12289011,12.1875 8.80993522,8.58761719 9.94087712,7.23835938 C11.1484642,5.79820313 10.7460771,3.39777344 11.5512771,2.4375 C13.5640641,2.4375 13.5640641,4.11226563 13.5640641,5.31832031 C13.5640641,7.30742188 12.3564771,8.19863281 12.3564771,10.1191797 L16.7844382,10.1191797 C17.6833156,10.1191797 18.3910059,11.0794531 18.3948382,12.0397266 C18.3986704,12.9994922 17.8489543,13.9597656 17.4465672,13.9597656 C18.0209375,14.6988867 18.1436549,16.2569063 17.2247221,17.2920313 Z M3.74709666,21.9375 C3.74709666,22.6106055 3.28956764,23.15625 2.72516121,23.15625 C2.16075477,23.15625 1.70322576,22.6106055 1.70322576,21.9375 C1.70322576,21.2643945 2.16075477,20.71875 2.72516121,20.71875 C3.28956764,20.71875 3.74709666,21.2643945 3.74709666,21.9375 Z" id="Shape"/>
            </g>
        </symbol>
    </defs>
</svg>

<div class="backdrop p-3" id="left-column" style="width: 13vw; min-width: 150px; height: 77vh; overflow: scroll; text-align: center">
    <h5 class="mb-3 text-muted">Participants</h5>
    <div class="participant hidden" id="ID"> NAME </div>

    {% for participant in participants %}
    {% if participant.present == True %}
    <div class="participant" id="{{participant.pk}}"> {{participant.name}} </div>
    {% endif %}
    {% endfor %}
</div>

<div class="center mx-4">
    <div class="inner" style="{% if poll == None %}transform: rotateY(180deg) {% endif %}">
        <div class="center-front" style="overflow: hidden; ">

               <i class="fas fa-archive chart-icon" style="float: left;"></i>
                <div style="display: inline-block; width: 60%; text-align: center;">
                  <i class="fas fa-chart-pie chart-icon {% if poll.type == 'n' %} click-disabled {% endif %}" style="text-align: center;"></i>
                  <i class="far fa-chart-bar chart-icon active" style="float: center;"></i>
                </div>

               <a class="chart-button" href="#">PNG</a>
               <a class="chart-button" href="/export/{{room.roomid}}">CSV</a>

                <h5 class="chart-title">{{poll.title}}</h5>
                <div class="p-3" style="width: 90%; height: 80%; text-align: center;">
                    <canvas id="pollchart"></canvas>
                </div>

        </div>

        <div class="rotated center-back p-3" style="overflow: scroll;">
            <h5>Create a New Poll</h5>
            <div class="mt-4">

                {{newpoll.title}}
                <div class="tabs d-flex justify-content-between align-items-center" style="display: inline-flex;">
                    <div data-name="mc" class="pointer polltype" style="border-radius: 1rem; height: 60px; width: 33%; margin: 5px;">
                        <svg class="icon-mc" style="margin-top: 10px;">
                            <use xlink:href="#MC-icon2"></use>
                        </svg>
                        <p class="type-text" style="font-size: 13px;">MULTIPLE CHOICE</p>
                    </div>
                    <div data-name="yn" class="pointer polltype" style="border-radius: 1rem; height: 60px; width: 33%; margin-top: 5px; margin-bottom: 5px;">
                        <svg class="icon-yn" style="margin-top: 10px">
                            <use xlink:href="#YN-icon2"></use>
                        </svg>
                        <p class="type-text" style="font-size: 13px;">YES/NO</p>
                    </div>
                    <div data-name="n" class="pointer polltype" style="border-radius: 1rem; height: 60px; width: 33%; margin: 5px;">
                        <p class="icon-n" style="font-size: 19px; margin-top: 7px; margin-bottom: 0px;">7.5/10</p>
                        <p class="type-text" style="font-size: 13px;">NUMBERED</p>
                    </div>
                </div>

                <div id="mcform" class="hidden poll-type-form">
                    <div id="add_form" style="display: inline-block; width: 95%;">
                        <input id="choice_0" type="text" name="mc_choice" class="form-control option" placeholder="A." autocomplete="off" style="width: 90%; border-radius: 0.7rem; margin-left: 0; background-color: var(--mydarkgrey)";>
                    </div>
                    <div id="add_container">
                        <i id="add_more" class="fas fa-plus-circle"></i>
                    </div>
                </div>

                <div id="ynform" class="hidden poll-type-form">

                </div>

                <div id="nform" class="hidden poll-type-form" style="text-align: center; margin-bottom: 10px;">
                    <input type="text" name="start" class="form-control" id="id_start" autocomplete="off" placeholder="Start" style="width:140px; margin-right: 5px; margin-top: 10px;">
                    <input type="text" name="end" class="form-control" id="id_end" autocomplete="off" placeholder="End" style="width:140px; margin-left: 5px;">

                </div>

                <button id="startpoll" type="button" class="btn text-white my-4 hidden" style="background-color: var(--myblue);border-radius: 1rem; width: 300px;">Start Poll</button>

            </div>
        </div>
    </div>
</div>

<div class="right">
    <div class="inner" style="{% if poll == None %}transform: rotateY(180deg) {% endif %}">
        <div class="right-front" style="overflow-y: scroll; width: 250px; min-height: 77vh;">
                <div style="justify-content: space-between; height: 100%; flex-direction: column; display: inline-flex;">
                    <div>
                        <div class="m-3" style="background-color: var(--mydarkgrey); text-align: center; border-radius: 0.5rem;">
                            <span id="votecount" class="odometer" style="font-size: 60px; vertical-align: inherit;">{{count}}</span>
                            <span style="font-size: 30px;">&nbsp;Votes</span>
                        </div>

                        <div id="pollstats">

                            {% if poll.type == 'mc' %}
                            {% mc_legend_data poll as legend_data %}
                            {% elif poll.type == 'yn' %}
                            {% yn_legend_data poll as legend_data %}
                            {% elif poll.type == 'n' %}
                            {% n_legend_data poll as legend_data %}
                            {% endif %}

                            <script>
                                var totalvotes

                                {% if poll != None %}
                                var initial_data = {{legend_data.1}} //load initial poll data
                                totalvotes = {{count | jsn}}

                                // declare vars for numbered polls

                                var start
                                var end
                                {% else %}
                                totalvotes = 0  // 0 if no polls exist
                                {% endif %}
                            </script>

                            <div class="d-flex align-items-center series hidden">
                                <span class="marker m-4" style="display: inline-block; width: 12px; height: 12px; background-color: #1FC8A4; border-radius: 50%"></span>
                                <p style="text-align: left; margin: 0; padding-right: 24px">
                                    <span data-name="label-INDEX">LABEL:&nbsp;</span>
                                    <span data-name="count-INDEX">COUNT votes&nbsp;</span>
                                    <span class="percent" data-name="percent-INDEX">(PERCENT%)</span>
                                </p>
                            </div>
                            <div class="d-flex align-items-center nseries hidden">
                                <span class="marker m-4" style="display: inline-block; width: 12px; height: 12px; background-color: #1FC8A4; border-radius: 50%"></span>
                                <p style="text-align: left; margin: 0; padding-right: 24px">
                                Average:&nbsp;AVG
                                </p>
                            </div>

                            {% if poll.type != 'n' %}
                            {% for option in legend_data.0 %}
                             <div class="d-flex align-items-center series">
                                <span class="marker m-4" style="display: inline-block; width: 12px; height: 12px; background-color: #1FC8A4; border-radius: 50%"></span>
                                <p style="text-align: left; margin: 0; padding-right: 24px">
                                    <span data-name="label-{{forloop.counter0}}">{{option.0}}:&nbsp;</span>
                                    <span data-name="count-{{forloop.counter0}}">{{option.1}} votes&nbsp;</span>
                                    <span class="percent" data-name="percent-{{forloop.counter0}}">({{option.2}}%)</span>
                                </p>
                            </div>
                            {% endfor %}
                            {% elif poll.type == 'n' %}

                            <script>
                                start = {{options.0 | jsn}}
                                end = {{options.1 | jsn}}
                            </script>

                            <div class="d-flex align-items-center nseries">
                                <span class="marker m-4" style="display: inline-block; width: 12px; height: 12px; background-color: #1FC8A4; border-radius: 50%"></span>
                                <p style="text-align: left; margin: 0; padding-right: 24px">
                                Average:&nbsp;{{legend_data.0.avg}}
                                </p>
                            </div>

                            {% endif %}


                        </div>
                    </div>
                    <div class="mb-2">
                        <button type="submit" id="closepoll" class="btn text-white mb-3 mx-3" style="height: 48px; border-radius: 0.7rem; width: 87.2%; background-color: var(--myblue);">Close Poll</button>
                        <button type="submit" id="resetpoll" class="btn mx-3" style="color: #605B5B; height: 48px; border-radius: 0.7rem; width: 87.2%; background-color: var(--mydarkgrey);">Reset</button>
                    </div>
                </div>
        </div>


        <div class="rotated right-back p-3" style="overflow-y: scroll; width: 250px; min-height: 77vh;">

                <h5>Recent Polls</h5>
        </div>

    </div>
</div>

</body>

<script>

   var roomid = {{roomid}}

   series = $(".series.hidden").prop('outerHTML')
   nseries = $(".nseries.hidden").prop('outerHTML') //series for numbered polls
   participant = $(".participant.hidden").prop('outerHTML') //placeholder for names
   participant = participant.replace("hidden", '')

   $(".series.hidden,.nseries.hidden,.participant.hidden").remove() //so we don't mess up our iterations with dummy elements

   var socket = new WebSocket('ws://' + window.location.host +'/ws/' + roomid + '/');
   var type;

    socket.onclose = function(e) {
        console.error('Socket closed unexpectedly');
    };

</script>


<!-- declare javascript vars-->
<script src="{% static 'polls/js/chartjs-plugin-labels.min.js' %}"></script>

<script src="{% static 'polls/js/live2.js' %}"></script>
<script>
    window.odometerOptions = {
        format: 'd',
    };

</script>

<script>

    var field;

    $(document).ready(function(){

        $(".polltype").click(function(){

            $(this).addClass("selected")
            $(this).siblings(".polltype").removeClass("selected")
            $("#startpoll").removeClass("hidden")

            type = $(this).attr('data-name')

            $(".poll-type-form").addClass("hidden")
            $("#"+type+"form").removeClass("hidden")

        });


        field = $("#add_form").html()

        var count = 0
        var alpha = ['A.', 'B.', 'C.', 'D.', 'E.', 'F.', 'G.', 'H.', 'I.', 'J.'] // 10 choices max

        $('#add_more').click(function() {
            count +=1

            if (count === 9){
                $("#add_more").addClass("hidden")
            }

            $('#add_form').append(field.replace('choice_0', 'choice_'+count));
            $("#choice_"+count).attr('placeholder', alpha[count])
        });




    });

</script>

<script>

    if (typeof initial_data != 'undefined'){
        type = {{poll.type | jsn}}
        drawChart(initial_data)
    }

    else {
        drawChart(0)
    }



</script>


</html>